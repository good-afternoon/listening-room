"use strict";THREE.TDSLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]},THREE.TDSLoader.prototype={constructor:THREE.TDSLoader,crossOrigin:"anonymous",load:function(e,t,s,i){var r=this,A=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),_=new THREE.FileLoader(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.load(e,function(e){t(r.parse(e,A))},s,i)},parse:function(e,t){this.group=new THREE.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var s=0;s<this.meshes.length;s++)this.group.add(this.meshes[s]);return this.group},readFile:function(e,t){var s=new DataView(e),i=this.readChunk(s);if(i.id===MLIBMAGIC||i.id===CMAGIC||i.id===M3DMAGIC)for(var r=this.nextChunk(s,i);0!==r;){if(r===M3D_VERSION){var A=this.readDWord(s);this.debugMessage("3DS file version: "+A)}else r===MDATA?(this.resetPosition(s),this.readMeshData(s,t)):this.debugMessage("Unknown main chunk: "+r.toString(16));r=this.nextChunk(s,i)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var s=this.readChunk(e),i=this.nextChunk(e,s);0!==i;){if(i===MESH_VERSION){var r=+this.readDWord(e);this.debugMessage("Mesh Version: "+r)}else if(i===MASTER_SCALE){var A=this.readFloat(e);this.debugMessage("Master scale: "+A),this.group.scale.set(A,A,A)}else i===NAMED_OBJECT?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):i===MAT_ENTRY?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+i.toString(16));i=this.nextChunk(e,s)}},readNamedObject:function(e){var t=this.readChunk(e),s=this.readString(e,64);t.cur=this.position;for(var i=this.nextChunk(e,t);0!==i;){if(i===N_TRI_OBJECT){this.resetPosition(e);var r=this.readMesh(e);r.name=s,this.meshes.push(r)}else this.debugMessage("Unknown named object chunk: "+i.toString(16));i=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var s=this.readChunk(e),i=this.nextChunk(e,s),r=new THREE.MeshPhongMaterial;0!==i;){if(i===MAT_NAME)r.name=this.readString(e,64),this.debugMessage("   Name: "+r.name);else if(i===MAT_WIRE)this.debugMessage("   Wireframe"),r.wireframe=!0;else if(i===MAT_WIRE_SIZE){var A=this.readByte(e);r.wireframeLinewidth=A,this.debugMessage("   Wireframe Thickness: "+A)}else if(i===MAT_TWO_SIDE)r.side=THREE.DoubleSide,this.debugMessage("   DoubleSided");else if(i===MAT_ADDITIVE)this.debugMessage("   Additive Blending"),r.blending=THREE.AdditiveBlending;else if(i===MAT_DIFFUSE)this.debugMessage("   Diffuse Color"),r.color=this.readColor(e);else if(i===MAT_SPECULAR)this.debugMessage("   Specular Color"),r.specular=this.readColor(e);else if(i===MAT_AMBIENT)this.debugMessage("   Ambient color"),r.color=this.readColor(e);else if(i===MAT_SHININESS){var _=this.readWord(e);r.shininess=_,this.debugMessage("   Shininess : "+_)}else i===MAT_TEXMAP?(this.debugMessage("   ColorMap"),this.resetPosition(e),r.map=this.readMap(e,t)):i===MAT_BUMPMAP?(this.debugMessage("   BumpMap"),this.resetPosition(e),r.bumpMap=this.readMap(e,t)):i===MAT_OPACMAP?(this.debugMessage("   OpacityMap"),this.resetPosition(e),r.alphaMap=this.readMap(e,t)):i===MAT_SPECMAP?(this.debugMessage("   SpecularMap"),this.resetPosition(e),r.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+i.toString(16));i=this.nextChunk(e,s)}this.endChunk(s),this.materials[r.name]=r},readMesh:function(e){var t=this.readChunk(e),s=this.nextChunk(e,t),i=new THREE.BufferGeometry,r=[],A=new THREE.MeshPhongMaterial,_=new THREE.Mesh(i,A);for(_.name="mesh";0!==s;){if(s===POINT_ARRAY){var a=this.readWord(e);this.debugMessage("   Vertex: "+a);for(var n=[],T=0;T<a;T++)n.push(this.readFloat(e)),n.push(this.readFloat(e)),n.push(this.readFloat(e));i.addAttribute("position",new THREE.Float32BufferAttribute(n,3))}else if(s===FACE_ARRAY)this.resetPosition(e),this.readFaceArray(e,_);else if(s===TEX_VERTS){var M=this.readWord(e);this.debugMessage("   UV: "+M);for(var r=[],T=0;T<M;T++)r.push(this.readFloat(e)),r.push(this.readFloat(e));i.addAttribute("uv",new THREE.Float32BufferAttribute(r,2))}else if(s===MESH_MATRIX){this.debugMessage("   Tranformation Matrix (TODO)");for(var h=[],T=0;T<12;T++)h[T]=this.readFloat(e);var E=new THREE.Matrix4;E.elements[0]=h[0],E.elements[1]=h[6],E.elements[2]=h[3],E.elements[3]=h[9],E.elements[4]=h[2],E.elements[5]=h[8],E.elements[6]=h[5],E.elements[7]=h[11],E.elements[8]=h[1],E.elements[9]=h[7],E.elements[10]=h[4],E.elements[11]=h[10],E.elements[12]=0,E.elements[13]=0,E.elements[14]=0,E.elements[15]=1,E.transpose();var o=new THREE.Matrix4;o.getInverse(E,!0),i.applyMatrix(o),E.decompose(_.position,_.quaternion,_.scale)}else this.debugMessage("   Unknown mesh chunk: "+s.toString(16));s=this.nextChunk(e,t)}return this.endChunk(t),i.computeVertexNormals(),_},readFaceArray:function(e,t){var s=this.readChunk(e),i=this.readWord(e);this.debugMessage("   Faces: "+i);for(var r=[],A=0;A<i;++A){r.push(this.readWord(e),this.readWord(e),this.readWord(e));this.readWord(e)}for(t.geometry.setIndex(r);this.position<s.end;){if((s=this.readChunk(e)).id===MSH_MAT_GROUP){this.debugMessage("      Material Group"),this.resetPosition(e);var _=this.readMaterialGroup(e),a=this.materials[_.name];void 0!==a&&(t.material=a,""===a.name&&(a.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+s.toString(16));this.endChunk(s)}this.endChunk(s)},readMap:function(e,t){var s=this.readChunk(e),i=this.nextChunk(e,s),r={},A=new THREE.TextureLoader(this.manager);for(A.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==i;){if(i===MAT_MAPNAME){var _=this.readString(e,128);r=A.load(_),this.debugMessage("      File: "+t+_)}else i===MAT_MAP_UOFFSET?(r.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+r.offset.x)):i===MAT_MAP_VOFFSET?(r.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+r.offset.y)):i===MAT_MAP_USCALE?(r.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+r.repeat.x)):i===MAT_MAP_VSCALE?(r.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+r.repeat.y)):this.debugMessage("      Unknown map chunk: "+i.toString(16));i=this.nextChunk(e,s)}return this.endChunk(s),r},readMaterialGroup:function(e){this.readChunk(e);var t=this.readString(e,64),s=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+s);for(var i=[],r=0;r<s;++r)i.push(this.readWord(e));return{name:t,index:i}},readColor:function(e){var t=this.readChunk(e),s=new THREE.Color;if(t.id===COLOR_24||t.id===LIN_COLOR_24){var i=this.readByte(e),r=this.readByte(e),A=this.readByte(e);s.setRGB(i/255,r/255,A/255),this.debugMessage("      Color: "+s.r+", "+s.g+", "+s.b)}else if(t.id===COLOR_F||t.id===LIN_COLOR_F){var i=this.readFloat(e),r=this.readFloat(e),A=this.readFloat(e);s.setRGB(i,r,A),this.debugMessage("      Color: "+s.r+", "+s.g+", "+s.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),s},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var s=this.readChunk(e);return t.cur+=s.size,s.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var s="",i=0;i<t;i++){var r=this.readByte(e);if(!r)break;s+=String.fromCharCode(r)}return s},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},debugMessage:function(e){this.debug&&console.log(e)}};var NULL_CHUNK=0,M3DMAGIC=19789,SMAGIC=11565,LMAGIC=11581,MLIBMAGIC=15786,MATMAGIC=15871,CMAGIC=49725,M3D_VERSION=2,M3D_KFVERSION=5,COLOR_F=16,COLOR_24=17,LIN_COLOR_24=18,LIN_COLOR_F=19,INT_PERCENTAGE=48,FLOAT_PERCENTAGE=49,MDATA=15677,MESH_VERSION=15678,MASTER_SCALE=256,LO_SHADOW_BIAS=5120,HI_SHADOW_BIAS=5136,SHADOW_MAP_SIZE=5152,SHADOW_SAMPLES=5168,SHADOW_RANGE=5184,SHADOW_FILTER=5200,RAY_BIAS=5216,O_CONSTS=5376,AMBIENT_LIGHT=8448,BIT_MAP=4352,SOLID_BGND=4608,V_GRADIENT=4864,USE_BIT_MAP=4353,USE_SOLID_BGND=4609,USE_V_GRADIENT=4865,FOG=8704,FOG_BGND=8720,LAYER_FOG=8962,DISTANCE_CUE=8960,DCUE_BGND=8976,USE_FOG=8705,USE_LAYER_FOG=8963,USE_DISTANCE_CUE=8961,MAT_ENTRY=45055,MAT_NAME=40960,MAT_AMBIENT=40976,MAT_DIFFUSE=40992,MAT_SPECULAR=41008,MAT_SHININESS=41024,MAT_SHIN2PCT=41025,MAT_TRANSPARENCY=41040,MAT_XPFALL=41042,MAT_USE_XPFALL=41536,MAT_REFBLUR=41043,MAT_SHADING=41216,MAT_USE_REFBLUR=41552,MAT_SELF_ILLUM=41092,MAT_TWO_SIDE=41089,MAT_DECAL=41090,MAT_ADDITIVE=41091,MAT_WIRE=41093,MAT_FACEMAP=41096,MAT_TRANSFALLOFF_IN=41098,MAT_PHONGSOFT=41100,MAT_WIREABS=41102,MAT_WIRE_SIZE=41095,MAT_TEXMAP=41472,MAT_SXP_TEXT_DATA=41760,MAT_TEXMASK=41790,MAT_SXP_TEXTMASK_DATA=41770,MAT_TEX2MAP=41786,MAT_SXP_TEXT2_DATA=41761,MAT_TEX2MASK=41792,MAT_SXP_TEXT2MASK_DATA=41772,MAT_OPACMAP=41488,MAT_SXP_OPAC_DATA=41762,MAT_OPACMASK=41794,MAT_SXP_OPACMASK_DATA=41774,MAT_BUMPMAP=41520,MAT_SXP_BUMP_DATA=41764,MAT_BUMPMASK=41796,MAT_SXP_BUMPMASK_DATA=41776,MAT_SPECMAP=41476,MAT_SXP_SPEC_DATA=41765,MAT_SPECMASK=41800,MAT_SXP_SPECMASK_DATA=41778,MAT_SHINMAP=41788,MAT_SXP_SHIN_DATA=41766,MAT_SHINMASK=41798,MAT_SXP_SHINMASK_DATA=41780,MAT_SELFIMAP=41789,MAT_SXP_SELFI_DATA=41768,MAT_SELFIMASK=41802,MAT_SXP_SELFIMASK_DATA=41782,MAT_REFLMAP=41504,MAT_REFLMASK=41804,MAT_SXP_REFLMASK_DATA=41784,MAT_ACUBIC=41744,MAT_MAPNAME=41728,MAT_MAP_TILING=41809,MAT_MAP_TEXBLUR=41811,MAT_MAP_USCALE=41812,MAT_MAP_VSCALE=41814,MAT_MAP_UOFFSET=41816,MAT_MAP_VOFFSET=41818,MAT_MAP_ANG=41820,MAT_MAP_COL1=41824,MAT_MAP_COL2=41826,MAT_MAP_RCOL=41828,MAT_MAP_GCOL=41830,MAT_MAP_BCOL=41832,NAMED_OBJECT=16384,N_DIRECT_LIGHT=17920,DL_OFF=17952,DL_OUTER_RANGE=18010,DL_INNER_RANGE=18009,DL_MULTIPLIER=18011,DL_EXCLUDE=18004,DL_ATTENUATE=17957,DL_SPOTLIGHT=17936,DL_SPOT_ROLL=18006,DL_SHADOWED=17968,DL_LOCAL_SHADOW2=17985,DL_SEE_CONE=18e3,DL_SPOT_RECTANGULAR=18001,DL_SPOT_ASPECT=18007,DL_SPOT_PROJECTOR=18003,DL_SPOT_OVERSHOOT=18002,DL_RAY_BIAS=18008,DL_RAYSHAD=17959,N_CAMERA=18176,CAM_SEE_CONE=18192,CAM_RANGES=18208,OBJ_HIDDEN=16400,OBJ_VIS_LOFTER=16401,OBJ_DOESNT_CAST=16402,OBJ_DONT_RECVSHADOW=16407,OBJ_MATTE=16403,OBJ_FAST=16404,OBJ_PROCEDURAL=16405,OBJ_FROZEN=16406,N_TRI_OBJECT=16640,POINT_ARRAY=16656,POINT_FLAG_ARRAY=16657,FACE_ARRAY=16672,MSH_MAT_GROUP=16688,SMOOTH_GROUP=16720,MSH_BOXMAP=16784,TEX_VERTS=16704,MESH_MATRIX=16736,MESH_COLOR=16741,MESH_TEXTURE_INFO=16752,KFDATA=45056,KFHDR=45066,KFSEG=45064,KFCURTIME=45065,AMBIENT_NODE_TAG=45057,OBJECT_NODE_TAG=45058,CAMERA_NODE_TAG=45059,TARGET_NODE_TAG=45060,LIGHT_NODE_TAG=45061,L_TARGET_NODE_TAG=45062,SPOTLIGHT_NODE_TAG=45063,NODE_ID=45104,NODE_HDR=45072,PIVOT=45075,INSTANCE_NAME=45073,MORPH_SMOOTH=45077,BOUNDBOX=45076,POS_TRACK_TAG=45088,COL_TRACK_TAG=45093,ROT_TRACK_TAG=45089,SCL_TRACK_TAG=45090,MORPH_TRACK_TAG=45094,FOV_TRACK_TAG=45091,ROLL_TRACK_TAG=45092,HOT_TRACK_TAG=45095,FALL_TRACK_TAG=45096,HIDE_TRACK_TAG=45097,POLY_2D=20480,SHAPE_OK=20496,SHAPE_NOT_OK=20497,SHAPE_HOOK=20512,PATH_3D=24576,PATH_MATRIX=24581,SHAPE_2D=24592,M_SCALE=24608,M_TWIST=24624,M_TEETER=24640,M_FIT=24656,M_BEVEL=24672,XZ_CURVE=24688,YZ_CURVE=24704,INTERPCT=24720,DEFORM_LIMIT=24736,USE_CONTOUR=24832,USE_TWEEN=24848,USE_SCALE=24864,USE_TWIST=24880,USE_TEETER=24896,USE_FIT=24912,USE_BEVEL=24928,DEFAULT_VIEW=12288,VIEW_TOP=12304,VIEW_BOTTOM=12320,VIEW_LEFT=12336,VIEW_RIGHT=12352,VIEW_FRONT=12368,VIEW_BACK=12384,VIEW_USER=12400,VIEW_CAMERA=12416,VIEW_WINDOW=12432,VIEWPORT_LAYOUT_OLD=28672,VIEWPORT_DATA_OLD=28688,VIEWPORT_LAYOUT=28673,VIEWPORT_DATA=28689,VIEWPORT_DATA_3=28690,VIEWPORT_SIZE=28704,NETWORK_VIEW=28720;